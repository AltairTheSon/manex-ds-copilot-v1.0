<div class="results-container" *ngIf="!isLoading">
  <!-- File Information Header -->
  <div class="file-header" *ngIf="fileInfo">
    <div class="file-info">
      <h1 class="file-name">
        <i class="ri-figma-fill"></i>
        {{ fileInfo.name }}
      </h1>
      <div class="file-meta">
        <span class="meta-item">
          <i class="ri-time-line"></i>
          Last modified: {{ formatDate(fileInfo.lastModified) }}
        </span>
        <span class="meta-item">
          <i class="ri-git-branch-line"></i>
          Version: {{ fileInfo.version }}
        </span>
      </div>
    </div>
  </div>

  <!-- Navigation Tabs -->
  <div class="results-tabs">
    <button 
      class="tab-button"
      [class.active]="selectedTab === 'pages'"
      (click)="selectTab('pages')"
    >
      <i class="ri-file-copy-2-line"></i>
      Pages
      <span class="tab-count">{{ pages.length }}</span>
    </button>
    <button 
      class="tab-button"
      [class.active]="selectedTab === 'tokens'"
      (click)="selectTab('tokens')"
    >
      <i class="ri-palette-line"></i>
      Design Tokens & Styles
      <span class="tab-count">{{ designTokens.length + localStyles.length }}</span>
    </button>
    <button 
      class="tab-button"
      [class.active]="selectedTab === 'components'"
      (click)="selectTab('components')"
    >
      <i class="ri-shapes-line"></i>
      Components & Variants
      <span class="tab-count">{{ components.length }}</span>
    </button>
    <button 
      class="tab-button"
      [class.active]="selectedTab === 'sync'"
      (click)="selectTab('sync')"
    >
      <i class="ri-refresh-line"></i>
      Live Sync
      <span class="tab-count" *ngIf="syncStatus.isAutoSync">ON</span>
      <span class="tab-count" *ngIf="!syncStatus.isAutoSync">OFF</span>
    </button>
  </div>

  <!-- Pages Tab -->
  <div class="tab-content" *ngIf="selectedTab === 'pages'">
    <!-- Pages List View -->
    <div *ngIf="!selectedPage">
      <div class="pages-grid" *ngIf="pages.length > 0; else noPages">
        <div class="page-card" *ngFor="let page of pages" (click)="onPageClick(page)">
          <div class="page-image">
            <img 
              [src]="page.thumbnail" 
              [alt]="page.name"
              (error)="onImageError($event)"
              loading="lazy"
            />
            <div class="page-overlay">
              <div class="page-children-count">
                {{ page.children?.length || 0 }} frames
              </div>
            </div>
          </div>
          <div class="page-info">
            <h3 class="page-name">{{ page.name }}</h3>
            <div class="page-details">
              <div class="detail-item">
                <i class="ri-layout-grid-line"></i>
                {{ page.children?.length || 0 }} frames
              </div>
              <div class="detail-item">
                <i class="ri-cursor-line"></i>
                Click to view artboards
              </div>
            </div>
          </div>
        </div>
      </div>

      <ng-template #noPages>
        <div class="empty-state">
          <i class="ri-file-copy-2-line"></i>
          <h3>No Pages Found</h3>
          <p>This Figma file doesn't contain any pages or they couldn't be loaded.</p>
        </div>
      </ng-template>
    </div>

    <!-- Page Artboards View -->
    <div *ngIf="selectedPage">
      <div class="page-artboards-header">
        <button class="back-button" (click)="backToPages()">
          <i class="ri-arrow-left-line"></i>
          Back to Pages
        </button>
        <div class="page-info">
          <h2 class="page-title">{{ selectedPage.name }}</h2>
          <p class="page-subtitle">Artboards within this page</p>
        </div>
      </div>

      <!-- Loading state for artboards -->
      <div class="loading-artboards" *ngIf="isLoadingArtboards">
        <div class="loading-spinner">
          <i class="ri-loader-4-line"></i>
        </div>
        <p>Loading artboards...</p>
      </div>

      <!-- Artboards Grid -->
      <div class="artboards-grid" *ngIf="!isLoadingArtboards && pageArtboards.length > 0">
        <div class="artboard-card" *ngFor="let artboard of pageArtboards">
          <div class="artboard-image">
            <img 
              [src]="artboard.thumbnail" 
              [alt]="artboard.name"
              (error)="onImageError($event)"
              loading="lazy"
            />
            <div class="artboard-overlay">
              <div class="artboard-dimensions">
                {{ artboard.absoluteBoundingBox.width }}×{{ artboard.absoluteBoundingBox.height }}
              </div>
            </div>
          </div>
          <div class="artboard-info">
            <h3 class="artboard-name">{{ artboard.name }}</h3>
            <div class="artboard-details">
              <div class="detail-item">
                <i class="ri-ruler-line"></i>
                {{ artboard.absoluteBoundingBox.width }}×{{ artboard.absoluteBoundingBox.height }}
              </div>
              <div class="detail-item">
                <i class="ri-layout-2-line"></i>
                {{ artboard.type }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- No artboards found -->
      <div class="empty-state" *ngIf="!isLoadingArtboards && pageArtboards.length === 0">
        <i class="ri-layout-grid-line"></i>
        <h3>No Artboards Found</h3>
        <p>This page doesn't contain any frame artboards.</p>
      </div>
    </div>
  </div>

  <!-- Design Tokens Tab -->
  <div class="tab-content" *ngIf="selectedTab === 'tokens'">
    <div class="tokens-header" *ngIf="designTokens.length > 0">
      <button class="download-button" (click)="downloadTokensAsCSV()">
        <i class="ri-download-2-line"></i>
        Download CSV
      </button>
    </div>

    <div class="tokens-content" *ngIf="designTokens.length > 0; else noTokens">
      <div class="token-category" *ngFor="let category of getUniqueCategories()">
        <h3 class="category-title">
          <i class="ri-folder-3-line"></i>
          {{ category | titlecase }}
        </h3>
        <div class="tokens-grid">
          <div class="token-card" *ngFor="let token of getTokensByCategory(category)">
            <div class="token-header">
              <div class="token-type">
                <i [class]="'ri-' + (token.type === 'color' ? 'palette' : token.type === 'typography' ? 'font-size' : token.type === 'shadow' ? 'drop' : 'ruler') + '-line'"></i>
                {{ token.type | titlecase }}
              </div>
              <div class="token-name">{{ token.name }}</div>
            </div>
            <div class="token-value">
              <div class="value-preview" *ngIf="token.type === 'color'">
                <span class="color-swatch" [style.background-color]="token.value"></span>
              </div>
              <code class="value-code">{{ token.value }}</code>
            </div>
            <div class="token-description" *ngIf="token.description">
              {{ token.description }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <ng-template #noTokens>
      <div class="empty-state">
        <i class="ri-palette-line"></i>
        <h3>No Design Tokens Found</h3>
        <p>No design tokens were extracted from this Figma file. Try a file with defined styles and components.</p>
      </div>
    </ng-template>
  </div>

  <!-- Components & Variants Tab -->
  <div class="tab-content" *ngIf="selectedTab === 'components'">
    <div class="components-header" *ngIf="components.length > 0">
      <div class="filter-buttons">
        <button class="filter-button active">All Components</button>
        <button class="filter-button">With Variants</button>
        <button class="filter-button">Recently Used</button>
      </div>
    </div>

    <div class="components-content" *ngIf="components.length > 0; else noComponents">
      <div class="components-grid">
        <div class="component-card" *ngFor="let component of components">
          <div class="component-image">
            <img 
              [src]="component.thumbnail || 'assets/component-placeholder.png'" 
              [alt]="component.name"
              (error)="onImageError($event)"
              loading="lazy"
            />
            <div class="component-overlay" *ngIf="component.variants && component.variants.length">
              <div class="variant-count">
                {{ component.variants.length }} variants
              </div>
            </div>
          </div>
          <div class="component-info">
            <h3 class="component-name">{{ component.name }}</h3>
            <p class="component-description" *ngIf="component.description">
              {{ component.description }}
            </p>
            <div class="component-details">
              <div class="detail-item" *ngIf="component.variants && component.variants.length">
                <i class="ri-git-branch-line"></i>
                {{ component.variants.length }} variants
              </div>
              <div class="detail-item" *ngIf="component.properties && component.properties.length">
                <i class="ri-settings-3-line"></i>
                {{ component.properties.length }} properties
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <ng-template #noComponents>
      <div class="empty-state">
        <i class="ri-shapes-line"></i>
        <h3>No Components Found</h3>
        <p>This Figma file doesn't contain any main components or they couldn't be loaded.</p>
      </div>
    </ng-template>
  </div>

  <!-- Live Sync Dashboard Tab -->
  <div class="tab-content" *ngIf="selectedTab === 'sync'">
    <div class="sync-dashboard">
      <div class="sync-status">
        <div class="status-header">
          <h3>Sync Status</h3>
          <div class="sync-toggle">
            <label class="toggle-switch">
              <input type="checkbox" [checked]="syncStatus.isAutoSync" (change)="toggleAutoSync($event)">
              <span class="toggle-slider"></span>
            </label>
            <span class="toggle-label">Auto Sync</span>
          </div>
        </div>
        
        <div class="status-info">
          <div class="status-item">
            <i class="ri-time-line"></i>
            <span>Last synced: {{ syncStatus.lastSynced || 'Never' }}</span>
          </div>
          <div class="status-item">
            <i class="ri-check-line" *ngIf="syncStatus.isAutoSync"></i>
            <i class="ri-pause-line" *ngIf="!syncStatus.isAutoSync"></i>
            <span>{{ syncStatus.isAutoSync ? 'Auto sync enabled' : 'Auto sync disabled' }}</span>
          </div>
        </div>
      </div>

      <div class="sync-actions">
        <button class="sync-button primary" (click)="syncNow()">
          <i class="ri-refresh-line"></i>
          Sync Now
        </button>
        <button class="sync-button secondary" (click)="viewSyncHistory()">
          <i class="ri-history-line"></i>
          View History
        </button>
        <button class="sync-button secondary" (click)="openSyncSettings()">
          <i class="ri-settings-3-line"></i>
          Sync Settings
        </button>
      </div>

      <div class="sync-changes" *ngIf="false">
        <h4>Recent Changes</h4>
        <div class="changes-list">
          <div class="change-item">
            <i class="ri-palette-line"></i>
            <span>Color style "Primary Blue" updated</span>
            <span class="change-time">2 minutes ago</span>
          </div>
          <div class="change-item">
            <i class="ri-text"></i>
            <span>Text style "Heading Large" modified</span>
            <span class="change-time">5 minutes ago</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading State -->
<div class="loading-container" *ngIf="isLoading">
  <div class="loading-content">
    <div class="loading-spinner">
      <i class="ri-loader-4-line"></i>
    </div>
    <h2>Processing Figma File...</h2>
    <p>Extracting artboards and design tokens from your file</p>
  </div>
</div>

<!-- Sync History Modal -->
<div class="modal-overlay" *ngIf="showSyncHistoryModal" (click)="closeSyncHistoryModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Sync History</h3>
      <button class="modal-close" (click)="closeSyncHistoryModal()">
        <i class="ri-close-line"></i>
      </button>
    </div>
    <div class="modal-body">
      <div class="sync-history-list">
        <div class="history-item">
          <div class="history-icon">
            <i class="ri-check-line"></i>
          </div>
          <div class="history-details">
            <h4>Successful Sync</h4>
            <p>Updated 5 design tokens and 3 components</p>
            <span class="history-time">2 hours ago</span>
          </div>
        </div>
        <div class="history-item">
          <div class="history-icon">
            <i class="ri-check-line"></i>
          </div>
          <div class="history-details">
            <h4>Successful Sync</h4>
            <p>Updated 2 color tokens</p>
            <span class="history-time">1 day ago</span>
          </div>
        </div>
        <div class="history-item">
          <div class="history-icon error">
            <i class="ri-close-line"></i>
          </div>
          <div class="history-details">
            <h4>Sync Failed</h4>
            <p>Connection timeout - please try again</p>
            <span class="history-time">2 days ago</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Sync Settings Modal -->
<div class="modal-overlay" *ngIf="showSyncSettingsModal" (click)="closeSyncSettingsModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Sync Settings</h3>
      <button class="modal-close" (click)="closeSyncSettingsModal()">
        <i class="ri-close-line"></i>
      </button>
    </div>
    <div class="modal-body">
      <div class="setting-group">
        <h4>Auto Sync</h4>
        <div class="setting-item">
          <label class="toggle-switch">
            <input type="checkbox" [checked]="syncStatus.isAutoSync" (change)="toggleAutoSync($event)">
            <span class="toggle-slider"></span>
          </label>
          <div class="setting-info">
            <span class="setting-label">Enable Auto Sync</span>
            <p class="setting-description">Automatically sync changes when detected in Figma file</p>
          </div>
        </div>
      </div>
      
      <div class="setting-group">
        <h4>Sync Frequency</h4>
        <div class="setting-item">
          <select class="setting-select">
            <option value="5">Every 5 minutes</option>
            <option value="15" selected>Every 15 minutes</option>
            <option value="30">Every 30 minutes</option>
            <option value="60">Every hour</option>
          </select>
          <div class="setting-info">
            <span class="setting-label">Check for changes</span>
            <p class="setting-description">How often to check for file updates</p>
          </div>
        </div>
      </div>

      <div class="setting-group">
        <h4>Notifications</h4>
        <div class="setting-item">
          <label class="toggle-switch">
            <input type="checkbox" checked>
            <span class="toggle-slider"></span>
          </label>
          <div class="setting-info">
            <span class="setting-label">Desktop Notifications</span>
            <p class="setting-description">Show notifications when sync completes</p>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn secondary" (click)="closeSyncSettingsModal()">Cancel</button>
      <button class="btn primary" (click)="closeSyncSettingsModal()">Save Settings</button>
    </div>
  </div>
</div>
